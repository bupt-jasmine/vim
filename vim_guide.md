# Vim 实用指南

## 模式切换

Vim 有三种主要模式：

| 模式 | 说明 | 进入方式 | 退出方式 |
|-----|------|---------|---------|
| **普通模式** (Normal) | 默认模式，用于导航和命令 | `ESC` | - |
| **插入模式** (Insert) | 输入文本 | `i`, `a`, `o` 等 | `ESC` |
| **可视模式** (Visual) | 选择文本 | `v`, `V`, `Ctrl-v` | `ESC` |

### 进入插入模式的方式

| 命令 | 说明 |
|-----|------|
| `i` | 在光标前插入 |
| `I` | 在行首插入 |
| `a` | 在光标后插入 |
| `A` | 在行尾插入 |
| `o` | 在下一行插入 |
| `O` | 在上一行插入 |

---

## 光标移动

### 基本移动

| 命令 | 说明 |
|-----|------|
| `h` | 左移一个字符 |
| `j` | 下移一行 |
| `k` | 上移一行 |
| `l` | 右移一个字符 |

### 单词移动

| 命令 | 说明 |
|-----|------|
| `w` | 移动到下一个单词开头 |
| `b` | 移动到上一个单词开头 |
| `e` | 移动到当前单词结尾 |
| `ge` | 移动到上一个单词结尾 |
| `W/B/E` | 按空格分隔的单词移动（忽略标点） |

### 行内移动

| 命令 | 说明 |
|-----|------|
| `0` | 移到行首（第一个字符） |
| `^` | 移到行首第一个非空字符 |
| `$` | 移到行尾 |
| `g_` | 移到行尾最后一个非空字符 |
| `f{char}` | 向后查找字符并移动到该字符 |
| `F{char}` | 向前查找字符并移动到该字符 |
| `t{char}` | 向后查找字符并移动到字符前 |
| `T{char}` | 向前查找字符并移动到字符后 |
| `;` | 重复上次 `f/F/t/T` 查找（同方向） |
| `,` | 重复上次 `f/F/t/T` 查找（反方向） |

### 屏幕移动

| 命令 | 说明 |
|-----|------|
| `H` | 移到屏幕顶部 |
| `M` | 移到屏幕中间 |
| `L` | 移到屏幕底部 |
| `gg` | 移到文件开头 |
| `G` | 移到文件结尾 |
| `{number}G` | 跳到第 n 行（如 `50G` 跳到第 50 行） |
| `:{number}` | 跳到第 n 行（如 `:50` 跳到第 50 行） |

### 翻页

| 命令 | 说明 |
|-----|------|
| `Ctrl-u` | 向上翻半页 |
| `Ctrl-d` | 向下翻半页 |
| `Ctrl-b` | 向上翻整页 (backward) |
| `Ctrl-f` | 向下翻整页 (forward) |
| `zz` | 将当前行移到屏幕中央 |
| `zt` | 将当前行移到屏幕顶部 |
| `zb` | 将当前行移到屏幕底部 |

### 跳转

| 命令 | 说明 |
|-----|------|
| `%` | 跳到匹配的括号 `()`, `[]`, `{}` |
| `*` | 查找当前单词的下一个出现位置 |
| `#` | 查找当前单词的上一个出现位置 |
| `Ctrl-o` | 跳回上一个位置（跳转历史后退） |
| `Ctrl-i` | 跳到下一个位置（跳转历史前进） |
| `gd` | 跳到局部变量定义 |
| `gD` | 跳到全局变量定义 |

---

## 文本编辑

### 删除

| 命令 | 说明 |
|-----|------|
| `x` | 删除光标下的字符 |
| `X` | 删除光标前的字符 |
| `dd` | 删除整行 |
| `dw` | 删除到下个单词开头 |
| `de` | 删除到当前单词结尾 |
| `d$` 或 `D` | 删除到行尾 |
| `d0` | 删除到行首 |
| `d^` | 删除到行首第一个非空字符 |
| `diw` | 删除当前单词（delete inner word） |
| `daw` | 删除当前单词及空格（delete a word） |
| `di(` 或 `dib` | 删除括号 `()` 内的内容 |
| `da(` 或 `dab` | 删除括号 `()` 及其内容 |
| `di{` 或 `diB` | 删除大括号 `{}` 内的内容 |
| `di"` | 删除双引号 `"` 内的内容 |
| `dit` | 删除 HTML/XML 标签内的内容 |

**组合规则**: Vim 使用 **"动词 + 名词"** 模式

- `d` (delete) + `w` (word) = 删除单词
- `d` (delete) + `$` (行尾) = 删除到行尾
- `d` (delete) + `i(` (inner parentheses) = 删除括号内内容

### 复制与粘贴

| 命令 | 说明 |
|-----|------|
| `yy` 或 `Y` | 复制整行 |
| `yw` | 复制单词 |
| `y$` | 复制到行尾 |
| `yiw` | 复制当前单词 |
| `yi"` | 复制引号内内容 |
| `yap` | 复制整个段落（a paragraph） |
| `p` | 在光标后粘贴 |
| `P` | 在光标前粘贴 |
| `gp` | 粘贴并将光标移到粘贴内容后 |

#### 使用寄存器

| 命令 | 说明 |
|-----|------|
| `"ayy` | 复制当前行到寄存器 `a` |
| `"ap` | 从寄存器 `a` 粘贴 |
| `"+y` | 复制到系统剪贴板 |
| `"+p` | 从系统剪贴板粘贴 |
| `:reg` | 查看所有寄存器内容 |

### 修改操作

| 命令 | 说明 |
|-----|------|
| `r{char}` | 替换光标下的单个字符 |
| `R` | 进入替换模式（持续替换） |
| `cw` | 修改到下个单词开头 |
| `ce` | 修改到当前单词结尾 |
| `cc` 或 `S` | 修改整行 |
| `C` | 修改到行尾 |
| `ciw` | 修改当前单词 |
| `ci"` | 修改引号内内容 |
| `ci(` | 修改括号内内容 |
| `cit` | 修改 HTML/XML 标签内内容 |
| `s` | 删除字符并进入插入模式 |

### 大小写转换

| 命令 | 说明 |
|-----|------|
| `~` | 切换光标下字符的大小写 |
| `g~w` | 切换单词大小写 |
| `gUw` | 单词转大写 |
| `guw` | 单词转小写 |
| `gUU` 或 `gUgU` | 整行转大写 |
| `guu` 或 `gugu` | 整行转小写 |

### 撤销与重做

| 命令 | 说明 |
|-----|------|
| `u` | 撤销上一次操作 |
| `U` | 撤销整行的所有修改 |
| `Ctrl-r` | 重做（恢复撤销的操作） |
| `:earlier 5m` | 回到 5 分钟前的状态 |
| `:later 5m` | 前进到 5 分钟后的状态 |

### 缩进

| 命令 | 说明 |
|-----|------|
| `>>` | 增加当前行缩进 |
| `<<` | 减少当前行缩进 |
| `==` | 自动缩进当前行 |
| `gg=G` | 自动缩进全文 |
| `>%` | 缩进代码块（光标在括号上） |
| `5>>` | 缩进 5 行 |

### 重复操作

| 命令 | 说明 |
|-----|------|
| `.` | 重复上一次操作（最强大的命令之一！） |
| `3dd` | 删除 3 行 |
| `5j` | 向下移动 5 行 |
| `10p` | 粘贴 10 次 |

---

## 搜索与替换

### 搜索

| 命令 | 说明 |
|-----|------|
| `/pattern` | 向下搜索 `pattern` |
| `?pattern` | 向上搜索 `pattern` |
| `n` | 跳到下一个匹配 |
| `N` | 跳到上一个匹配 |
| `*` | 搜索光标下的单词（向下） |
| `#` | 搜索光标下的单词（向上） |
| `g*` | 搜索光标下的单词（部分匹配，向下） |
| `g#` | 搜索光标下的单词（部分匹配，向上） |

#### 搜索选项

```vim
/\<word\>       " 精确匹配整个单词（使用单词边界）
/word\c         " 不区分大小写搜索
/word\C         " 区分大小写搜索
/\vpattern      " 使用 very magic 模式（正则表达式更简洁）
```

#### 搜索设置

```vim
:set hlsearch      " 高亮搜索结果
:set incsearch     " 增量搜索（边输入边搜索）
:nohlsearch        " 取消高亮（简写 :noh）
:set ignorecase    " 搜索忽略大小写
:set smartcase     " 智能大小写（输入大写时区分大小写）
```

### 替换

基本语法：`:s/old/new/flags`

| 命令 | 说明 |
|-----|------|
| `:s/old/new/` | 替换当前行第一个匹配 |
| `:s/old/new/g` | 替换当前行所有匹配 |
| `:%s/old/new/g` | 替换全文所有匹配 |
| `:%s/old/new/gc` | 替换全文，每次确认 |
| `:5,12s/old/new/g` | 替换第 5-12 行 |
| `:'<,'>s/old/new/g` | 替换选中区域（可视模式下） |
| `:.,$s/old/new/g` | 从当前行到文件末尾 |

#### 替换标志

| 标志 | 说明 |
|-----|------|
| `g` | 全局替换（一行内所有匹配） |
| `c` | 确认每次替换 |
| `i` | 忽略大小写 |
| `I` | 不忽略大小写 |

#### 替换确认选项

在 `c` 标志确认时：

- `y` - 替换这一个
- `n` - 跳过这一个
- `a` - 替换所有剩余的
- `q` - 退出
- `l` - 替换这一个并退出

---

## 可视模式

### 进入可视模式

| 命令 | 说明 |
|-----|------|
| `v` | 字符选择模式 |
| `V` | 行选择模式 |
| `Ctrl-v` | 块选择模式（列编辑） |
| `gv` | 重新选择上次的选区 |

### 可视模式下的操作

选中文本后可以执行：

| 命令 | 说明 |
|-----|------|
| `d` | 删除选中内容 |
| `y` | 复制选中内容 |
| `c` | 修改选中内容 |
| `>` | 增加缩进 |
| `<` | 减少缩进 |
| `~` | 切换大小写 |
| `u` | 转小写 |
| `U` | 转大写 |
| `:` | 对选区执行命令 |
| `J` | 合并行 |
| `o` | 切换光标到选区的另一端 |

### 块编辑（列编辑）

**场景：在多行前添加注释**

```vim
Ctrl-v          " 进入块选择模式
j j j           " 向下选择多行（或使用 3j）
I               " 在选区前插入
// <ESC>        " 输入注释符并按 ESC，所有行都会插入
```

**场景：在多行后添加分号**

```vim
Ctrl-v          " 进入块选择模式
j j j           " 向下选择多行
$               " 移到行尾
A               " 在选区后插入
; <ESC>         " 输入分号并按 ESC
```

---

## 文件操作

### 打开与保存

| 命令 | 说明 |
|-----|------|
| `:e filename` | 打开文件 |
| `:e!` | 重新加载当前文件（放弃未保存的修改） |
| `:w` | 保存文件 |
| `:w filename` | 另存为 |
| `:w!` | 强制保存（覆盖只读） |
| `:wq` 或 `:x` | 保存并退出 |
| `ZZ` | 保存并退出（普通模式） |
| `:q` | 退出 |
| `:q!` | 强制退出（不保存） |
| `ZQ` | 不保存退出（普通模式） |
| `:wa` | 保存所有文件 |
| `:qa` | 退出所有文件 |
| `:wqa` | 保存并退出所有文件 |

### 文件浏览

| 命令 | 说明 |
|-----|------|
| `:Explore` 或 `:Ex` | 文件浏览器 |
| `:Sexplore` | 水平分割窗口浏览 |
| `:Vexplore` | 垂直分割窗口浏览 |
| `:e .` | 浏览当前目录 |
| `:e ..` | 浏览上级目录 |

### 缓冲区管理

| 命令 | 说明 |
|-----|------|
| `:ls` 或 `:buffers` | 列出所有缓冲区 |
| `:b number` | 切换到缓冲区（如 `:b 2`） |
| `:b filename` | 按名称切换（支持 Tab 补全） |
| `:bn` | 下一个缓冲区 (next) |
| `:bp` | 上一个缓冲区 (previous) |
| `:bf` | 第一个缓冲区 (first) |
| `:bl` | 最后一个缓冲区 (last) |
| `:bd` | 删除当前缓冲区 (delete) |
| `:bd number` | 删除指定缓冲区 |
| `Ctrl-^` | 切换到上一个缓冲区 |

---

## 窗口与标签页

### 窗口分割

| 命令 | 说明 |
|-----|------|
| `:split` 或 `:sp` | 水平分割当前窗口 |
| `:vsplit` 或 `:vsp` | 垂直分割当前窗口 |
| `:sp filename` | 水平分割并打开文件 |
| `:vsp filename` | 垂直分割并打开文件 |
| `Ctrl-w s` | 水平分割（普通模式） |
| `Ctrl-w v` | 垂直分割（普通模式） |
| `Ctrl-w q` | 关闭当前窗口 |
| `Ctrl-w o` | 只保留当前窗口（关闭其他） |
| `Ctrl-w c` | 关闭当前窗口 |

### 窗口切换

| 命令 | 说明 |
|-----|------|
| `Ctrl-w h` | 切换到左边窗口 |
| `Ctrl-w j` | 切换到下边窗口 |
| `Ctrl-w k` | 切换到上边窗口 |
| `Ctrl-w l` | 切换到右边窗口 |
| `Ctrl-w w` | 循环切换窗口 |
| `Ctrl-w p` | 切换到上一个窗口 |
| `Ctrl-w t` | 切换到顶部窗口 |
| `Ctrl-w b` | 切换到底部窗口 |

### 窗口移动

| 命令 | 说明 |
|-----|------|
| `Ctrl-w H` | 将窗口移到最左边（占满左侧） |
| `Ctrl-w J` | 将窗口移到最下边（占满底部） |
| `Ctrl-w K` | 将窗口移到最上边（占满顶部） |
| `Ctrl-w L` | 将窗口移到最右边（占满右侧） |
| `Ctrl-w r` | 旋转窗口 |
| `Ctrl-w x` | 交换窗口 |

### 窗口调整

| 命令 | 说明 |
|-----|------|
| `Ctrl-w =` | 所有窗口等宽/等高 |
| `Ctrl-w _` | 最大化当前窗口高度 |
| `Ctrl-w \|` | 最大化当前窗口宽度 |
| `Ctrl-w +` | 增加窗口高度 |
| `Ctrl-w -` | 减少窗口高度 |
| `Ctrl-w >` | 增加窗口宽度 |
| `Ctrl-w <` | 减少窗口宽度 |
| `:resize +5` | 增加 5 行高度 |
| `:vertical resize +5` | 增加 5 列宽度 |

### 标签页

| 命令 | 说明 |
|-----|------|
| `:tabnew` | 新建标签页 |
| `:tabnew filename` | 在新标签页中打开文件 |
| `:tabc` | 关闭当前标签页 |
| `:tabo` | 只保留当前标签页 |
| `gt` | 下一个标签页 |
| `gT` | 上一个标签页 |
| `{n}gt` | 跳到第 n 个标签页（如 `3gt`） |
| `:tabs` | 列出所有标签页 |
| `:tabm {n}` | 移动标签页到位置 n |

---

## 宏与重复

### 录制宏

宏可以录制一系列操作并重复执行。

| 命令 | 说明 |
|-----|------|
| `q{a-z}` | 开始录制宏到寄存器 a-z（如 `qa`） |
| `...操作...` | 执行要录制的操作 |
| `q` | 停止录制 |
| `@{a-z}` | 执行宏（如 `@a`） |
| `@@` | 重复上次执行的宏 |
| `10@a` | 执行宏 a 10 次 |

#### 示例：批量添加引号

```vim
qa              " 开始录制到寄存器 a
I"<ESC>         " 在行首插入 "
A"<ESC>         " 在行尾插入 "
j               " 移到下一行
q               " 停止录制
10@a            " 对接下来的 10 行执行宏
```

### 编辑宏

```vim
:let @a='...'   " 查看寄存器 a 的内容
:let @a=@a.'j'  " 在宏末尾添加 j（移到下一行）
```

---

## 高级技巧

### 文本对象

Vim 的 **文本对象** 是最强大的功能之一。

#### 语法

```
<操作符> <范围> <对象>
```

- **操作符**: `d` (删除), `c` (修改), `y` (复制), `v` (选择)
- **范围**: `i` (inner/内部), `a` (around/包含)
- **对象**: `w` (word), `s` (sentence), `p` (paragraph), `(`, `{`, `[`, `"`, `'`, `t` (tag)

#### 示例

| 命令 | 说明 |
|-----|------|
| `diw` | delete inner word（删除单词，不含空格） |
| `daw` | delete a word（删除单词及其后空格） |
| `ci"` | change inner "（修改双引号内容） |
| `da(` | delete around (（删除括号及内容） |
| `yi{` | yank inner {（复制大括号内内容） |
| `vit` | visual inner tag（选择 HTML 标签内内容） |
| `cip` | change inner paragraph（修改整段） |
| `das` | delete a sentence（删除整句） |

### 快速跳转

| 命令 | 说明 |
|-----|------|
| `gd` | 跳到局部变量定义 (go to definition) |
| `gD` | 跳到全局变量定义 |
| `Ctrl-]` | 跳转到标签定义（需要 ctags） |
| `Ctrl-t` | 跳回（标签跳转） |

### 标记 (Marks)

| 命令 | 说明 |
|-----|------|
| `m{a-z}` | 在当前位置设置标记（小写字母为文件内标记） |
| `m{A-Z}` | 设置全局标记（大写字母可跨文件） |
| <code>\`{a-z}</code> | 跳转到标记位置（精确到字符） |
| `'{a-z}` | 跳转到标记所在行首 |
| <code>\`\`</code> | 跳回上一个位置 |
| `''` | 跳回上一个位置（行首） |
| `:marks` | 查看所有标记 |

#### 特殊标记

| 标记 | 说明 |
|-----|------|
| <code>\`.</code> | 上次编辑的位置 |
| <code>\`"</code> | 上次退出时的位置 |
| <code>\`[</code> | 上次修改/复制的开始位置 |
| <code>\`]</code> | 上次修改/复制的结束位置 |

### 代码折叠

```vim
:set foldmethod=indent    " 基于缩进折叠
:set foldmethod=syntax    " 基于语法折叠
:set foldmethod=marker    " 基于标记折叠
```

| 命令 | 说明 |
|-----|------|
| `zc` | 关闭当前折叠 |
| `zo` | 打开当前折叠 |
| `za` | 切换当前折叠状态 |
| `zC` | 递归关闭所有折叠 |
| `zO` | 递归打开所有折叠 |
| `zR` | 打开所有折叠 |
| `zM` | 关闭所有折叠 |
| `zj` | 跳到下一个折叠 |
| `zk` | 跳到上一个折叠 |

### 多文件操作

#### 参数列表

```vim
:args *.js          " 将所有 .js 文件添加到参数列表
:argdo %s/old/new/ge | update   " 对所有文件执行替换并保存
:n                  " 下一个文件
:N                  " 上一个文件
```

#### 批量操作

```vim
:bufdo %s/old/new/ge | update   " 对所有缓冲区执行替换
:tabdo %s/old/new/ge | update   " 对所有标签页执行替换
:windo set number               " 对所有窗口设置行号
```

### 命令行技巧

| 命令 | 说明 |
|-----|------|
| `:!command` | 执行外部命令 |
| `:r !command` | 读取命令输出到当前位置 |
| `:w !command` | 将内容传递给命令 |
| `:%!sort` | 对所有行排序 |
| `:5,10!sort` | 对 5-10 行排序 |
| `Ctrl-r Ctrl-w` | 在命令行插入光标下的单词 |

### 寄存器系统

Vim 有多个寄存器用于存储文本：

| 寄存器 | 说明 |
|-------|------|
| `""` | 无名寄存器（默认） |
| `"0` - `"9` | 数字寄存器（复制历史） |
| `"a` - `"z` | 命名寄存器（用户使用） |
| `"+` | 系统剪贴板 |
| `"*` | X11 选择区域 |
| `"%` | 当前文件名 |
| `"#` | 上一个文件名 |
| `":` | 上一条命令 |
| `".` | 上次插入的文本 |
| `"/` | 上次搜索的模式 |

---

## 实用场景

### 场景 1：删除所有空行

```vim
:g/^$/d
```

### 场景 2：删除行尾空格

```vim
:%s/\s\+$//e
```

### 场景 3：在每行行首添加内容

```vim
:%s/^/# /
```

### 场景 4：交换两个单词

```vim
" 光标在第一个单词上
:s/\v(\w+)(\s+)(\w+)/\3\2\1/
```

### 场景 5：复制文件路径

```vim
:let @+ = expand("%:p")   " 完整路径到剪贴板
:let @+ = expand("%")     " 相对路径到剪贴板
```

### 场景 6：快速注释/取消注释

```vim
" 注释（块选择 + 插入）
Ctrl-v
选择行
I
# <ESC>

" 取消注释（块选择 + 删除）
Ctrl-v
选择 # 字符
d
```

---

